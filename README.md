# Craft-Market-Data-Transformation-incremental-load-SQL-
Этот проект реализует процесс загрузки данных из нескольких источников в хранилище данных.

## Структура проекта
```text
project/
├── sql_scripts/            # SQL-скрипты 
│   ├── dwh_customer_datamart_ddl.sql  # DDL для витрины отчетов
│   └── tmp_sources.sql   # Временная таблица
└── README.md               # Общая документация проекта
```

## Источники данных

Проект обрабатывает данные из четырех источников:
1. `source1.craft_market_wide` - денормализованная таблица с полными данными
2. `source2.craft_market_masters_products` + `source2.craft_market_orders_customers` - разделенные таблицы
3. `source3.craft_market_orders` + `source3.craft_market_craftsmans` + `source3.craft_market_customers` - нормализованная схема
4. `external_source.craft_products_orders` + `external_source.customers` - внешний источник

## Целевая модель данных

Данные загружаются в следующую схему хранилища:

### Dimensions (Справочники)
- `dwh.d_product` - информация о продуктах
- `dwh.d_customer` - информация о клиентах
- `dwh.d_craftsman` - информация о мастерах

### Facts (Факты)
- `dwh.f_order` - информация о заказах

## Логика ETL-процесса

1. **Extract**: 
   - Объединение данных из всех источников во временную таблицу `tmp_sources`
   - Учет различий в структуре источников

2. **Transform**:
   - Очистка и стандартизация данных
   - Подготовка данных для загрузки в витрины

3. **Load**:
   - Использование операций MERGE для инкрементального обновления
   - Обновление существующих записей при изменении
   - Добавление новых записей
   - Обновление метаданных (load_dttm)

## Особенности реализации

- Использование временных таблиц для промежуточных результатов
- Оптимизированные MERGE-операции для минимизации дублирования
- Поддержка истории изменений через метки времени
- Согласованность данных между измерениями и фактами

